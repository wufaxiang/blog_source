----
title: Java并发编程（1）：并发编程的挑战
category: Java并发编程
data: 2017-07-26 21:20:21
tags:
	- Java
	- 并发编程
----

并发编程目的是为了让程序运行的更快，但是并不是启动更多的线程就能让程序最大程度地并发运行。在并发编程时，会面临很多的挑战，下面介绍三种。

## 1. 上下文切换

即使是单核CPU也可以支持多线程执行代码，CPU通过给每个CPU时间片来实现这个机制。时间片是CPU分配给每个线程的时间，因为非常短，所以CPU通过切换线程执行，感觉就是多个线程是同时执行的。任务从保存到再加载的过程就是一次上下文切换。由于线程之间的不停切换所带来的开销，所以可能会比串形执行更慢。

要加快程序并发运行的速度，解决方案就是减少上下文切换。

<!--more-->

如何减少？

* 无锁并发编程：多线程竞争锁时会引起上下文切换
* CAS算法：方式同样是减少锁
* 使用最少线程：避免不需要的线程
* 协程：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换

## 2. 死锁
	
死锁是指两个或两个以上的进程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程。

如何避免？

几个常见方法：

* 避免一个线程同时获取多个锁
* 避免一个线程在锁内占用多个资源
* 尝试使用定时锁，使用lock.tryLock(timeout)来替换使用内部锁机制
* 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况

## 3. 资源限制的挑战

资源限制：硬件或软件资源的限制。硬件有带宽的上传／下载速度、硬盘读写和CPU处理速度。软件资源限制有数据库的连接数和socket连接数等。

解决方案：

* 硬件资源限制：可以考虑使用集群并执行程序
* 软件资源限制：可以考虑使用资源池将资源复用